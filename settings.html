<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
  <title>设置 - 循环计时器</title>
  <style>
    :root {
      --work-accent: #2dd4a0;
      --panel: rgba(255,255,255,0.12);
      --text: #f0f0f0;
      --muted: rgba(255,255,255,0.6);
    }
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: "SF Pro Display", -apple-system, "Segoe UI", sans-serif;
      min-height: 100vh;
      background: linear-gradient(160deg, #0f2027 0%, #1a3a47 50%, #0f2027 100%);
      color: var(--text);
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 24px;
      -webkit-tap-highlight-color: transparent;
    }
    .header {
      width: 100%;
      max-width: 340px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 24px;
    }
    .header-title {
      font-size: 1.1rem;
      font-weight: 600;
      letter-spacing: 0.02em;
      color: var(--muted);
    }
    .btn-back {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: 10px 16px;
      border-radius: 12px;
      border: none;
      background: rgba(255,255,255,0.12);
      color: var(--text);
      text-decoration: none;
      font-size: 0.95rem;
      cursor: pointer;
      transition: background 0.2s;
      -webkit-tap-highlight-color: transparent;
    }
    .btn-back:hover, .btn-back:active {
      background: rgba(255,255,255,0.2);
    }
    .card {
      background: var(--panel);
      border-radius: 20px;
      padding: 28px;
      width: 100%;
      max-width: 340px;
      backdrop-filter: blur(12px);
      border: 1px solid rgba(255,255,255,0.08);
    }
    .form-row {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 16px;
    }
    .form-row:last-of-type {
      margin-bottom: 24px;
    }
    label {
      font-size: 0.9rem;
      color: var(--muted);
      min-width: 80px;
    }
    input[type="number"] {
      flex: 1;
      padding: 12px 14px;
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,0.15);
      background: rgba(0,0,0,0.2);
      color: var(--text);
      font-size: 1rem;
    }
    input[type="number"]:focus {
      outline: none;
      border-color: var(--work-accent);
    }
    .unit {
      font-size: 0.9rem;
      color: var(--muted);
      flex-shrink: 0;
    }
    .btn-save {
      width: 100%;
      padding: 14px 24px;
      border: none;
      border-radius: 12px;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      background: var(--work-accent);
      color: #0d2a22;
      transition: transform 0.1s, opacity 0.2s;
    }
    .btn-save:active {
      transform: scale(0.98);
    }
  </style>
</head>
<body>
  <header class="header">
    <span class="header-title">设置</span>
    <a href="index.html" class="btn-back">返回</a>
  </header>
  <div class="card">
    <form id="form">
      <div class="form-row">
        <label for="workSec">每轮时间</label>
        <input type="number" id="workSec" min="1" max="999" value="30" />
        <span class="unit">秒</span>
      </div>
      <div class="form-row">
        <label for="restSec">间隔时间</label>
        <input type="number" id="restSec" min="0" max="999" value="20" />
        <span class="unit">秒</span>
      </div>
      <div class="form-row">
        <label for="cycles">循环次数</label>
        <input type="number" id="cycles" min="1" max="99" value="5" />
      </div>
      <button type="submit" class="btn-save">保存并返回</button>
    </form>
  </div>

  <script>
    (function () {
      'use strict';

      const STORAGE_KEY = 'cycletimer_settings';

      /**
       * 从 localStorage 读取设置并填充表单
       */
      function loadIntoForm() {
        try {
          const raw = localStorage.getItem(STORAGE_KEY);
          if (raw) {
            const o = JSON.parse(raw);
            const workSec = Math.max(1, Math.min(999, Number(o.workSec) || 30));
            const restSec = Math.max(0, Math.min(999, Number(o.restSec) ?? 20));
            const cycles = Math.max(1, Math.min(99, Number(o.cycles) || 5));
            document.getElementById('workSec').value = workSec;
            document.getElementById('restSec').value = restSec;
            document.getElementById('cycles').value = cycles;
            return;
          }
        } catch (e) { /* ignore */ }
        document.getElementById('workSec').value = 30;
        document.getElementById('restSec').value = 20;
        document.getElementById('cycles').value = 5;
      }

      /**
       * 校验并返回当前表单的数值
       * @returns {{ workSec: number, restSec: number, cycles: number } | null}
       */
      function getFormValues() {
        const work = parseInt(document.getElementById('workSec').value, 10);
        const rest = parseInt(document.getElementById('restSec').value, 10);
        const cycles = parseInt(document.getElementById('cycles').value, 10);
        if (isNaN(work) || work < 1 || work > 999) return null;
        if (isNaN(rest) || rest < 0 || rest > 999) return null;
        if (isNaN(cycles) || cycles < 1 || cycles > 99) return null;
        return { workSec: work, restSec: rest, cycles: cycles };
      }

      document.getElementById('form').addEventListener('submit', function (e) {
        e.preventDefault();
        const values = getFormValues();
        if (!values) {
          alert('请填写有效数值：每轮时间 1–999 秒，间隔 0–999 秒，循环 1–99 次。');
          return;
        }
        try {
          localStorage.setItem(STORAGE_KEY, JSON.stringify(values));
        } catch (err) {
          alert('保存失败，请重试。');
          return;
        }
        window.location.href = 'index.html';
      });

      loadIntoForm();
    })();
  </script>
</body>
</html>
