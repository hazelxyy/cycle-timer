<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
  <title>设置 - 循环计时器</title>
  <link rel="apple-touch-icon" sizes="180x180" href="icon.png" />
  <link rel="apple-touch-icon" href="icon.svg" />
  <style>
    :root {
      --bg: #fff;
      --text: #0a0a0a;
      --muted: #888;
      --line: #e5e5e5;
      --font: "Helvetica Neue", "SF Pro Text", -apple-system, sans-serif;
    }
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: var(--font);
      font-weight: 300;
      min-height: 100vh;
      background: var(--bg);
      color: var(--text);
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 48px 24px;
      -webkit-tap-highlight-color: transparent;
    }
    .header {
      width: 100%;
      max-width: 320px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 48px;
    }
    .header-title {
      font-size: 11px;
      font-weight: 400;
      letter-spacing: 0.2em;
      text-transform: uppercase;
      color: var(--muted);
    }
    .btn-back {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: 12px 20px;
      border: 1px solid var(--line);
      border-radius: 0;
      background: transparent;
      color: var(--text);
      font-family: var(--font);
      font-size: 11px;
      font-weight: 400;
      letter-spacing: 0.15em;
      text-transform: uppercase;
      text-decoration: none;
      cursor: pointer;
      transition: border-color 0.15s;
      -webkit-tap-highlight-color: transparent;
    }
    .btn-back:hover, .btn-back:active {
      border-color: var(--text);
    }
    .card {
      width: 100%;
      max-width: 320px;
      padding: 0;
    }
    .form-row {
      display: flex;
      align-items: center;
      gap: 16px;
      padding: 20px 0;
      border-bottom: 1px solid var(--line);
    }
    .form-row:last-of-type {
      border-bottom: none;
    }
    label {
      font-size: 12px;
      font-weight: 400;
      letter-spacing: 0.1em;
      color: var(--muted);
      min-width: 72px;
    }
    input[type="number"] {
      flex: 1;
      padding: 12px 0;
      border: none;
      border-bottom: 1px solid var(--line);
      background: transparent;
      color: var(--text);
      font-family: var(--font);
      font-size: 16px;
      font-weight: 300;
      transition: border-color 0.15s;
    }
    input[type="number"]:focus {
      outline: none;
      border-bottom-color: var(--text);
    }
    .unit {
      font-size: 12px;
      color: var(--muted);
      flex-shrink: 0;
    }
    .btn-save {
      width: 100%;
      margin-top: 48px;
      padding: 16px 24px;
      border: 1px solid var(--text);
      border-radius: 0;
      background: var(--text);
      color: var(--bg);
      font-family: var(--font);
      font-size: 12px;
      font-weight: 400;
      letter-spacing: 0.15em;
      text-transform: uppercase;
      cursor: pointer;
      transition: opacity 0.15s;
    }
    .btn-save:active {
      opacity: 0.8;
    }
  </style>
</head>
<body>
  <header class="header">
    <span class="header-title">设置</span>
    <a href="index.html" class="btn-back">返回</a>
  </header>
  <div class="card">
    <form id="form">
      <div class="form-row">
        <label for="workSec">每轮时间</label>
        <input type="number" id="workSec" min="1" max="999" value="30" />
        <span class="unit">秒</span>
      </div>
      <div class="form-row">
        <label for="restSec">间隔时间</label>
        <input type="number" id="restSec" min="0" max="999" value="20" />
        <span class="unit">秒</span>
      </div>
      <div class="form-row">
        <label for="cycles">循环次数</label>
        <input type="number" id="cycles" min="1" max="99" value="5" />
      </div>
      <button type="submit" class="btn-save">保存并返回</button>
    </form>
  </div>

  <script>
    (function () {
      'use strict';

      const STORAGE_KEY = 'cycletimer_settings';

      function loadIntoForm() {
        try {
          const raw = localStorage.getItem(STORAGE_KEY);
          if (raw) {
            const o = JSON.parse(raw);
            const workSec = Math.max(1, Math.min(999, Number(o.workSec) || 30));
            const restSec = Math.max(0, Math.min(999, Number(o.restSec) ?? 20));
            const cycles = Math.max(1, Math.min(99, Number(o.cycles) || 5));
            document.getElementById('workSec').value = workSec;
            document.getElementById('restSec').value = restSec;
            document.getElementById('cycles').value = cycles;
            return;
          }
        } catch (e) { /* ignore */ }
        document.getElementById('workSec').value = 30;
        document.getElementById('restSec').value = 20;
        document.getElementById('cycles').value = 5;
      }

      function getFormValues() {
        const work = parseInt(document.getElementById('workSec').value, 10);
        const rest = parseInt(document.getElementById('restSec').value, 10);
        const cycles = parseInt(document.getElementById('cycles').value, 10);
        if (isNaN(work) || work < 1 || work > 999) return null;
        if (isNaN(rest) || rest < 0 || rest > 999) return null;
        if (isNaN(cycles) || cycles < 1 || cycles > 99) return null;
        return { workSec: work, restSec: rest, cycles: cycles };
      }

      document.getElementById('form').addEventListener('submit', function (e) {
        e.preventDefault();
        const values = getFormValues();
        if (!values) {
          alert('请填写有效数值：每轮时间 1–999 秒，间隔 0–999 秒，循环 1–99 次。');
          return;
        }
        try {
          localStorage.setItem(STORAGE_KEY, JSON.stringify(values));
        } catch (err) {
          alert('保存失败，请重试。');
          return;
        }
        window.location.href = 'index.html';
      });

      loadIntoForm();
    })();
  </script>
</body>
</html>
